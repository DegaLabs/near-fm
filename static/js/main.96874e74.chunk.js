(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{118:function(e,t,n){"use strict";(function(e){var a=n(127),c=n(1),r=n.n(c),s=n(4),o=n(29),i=n(30),l=n(128),u=n(125),m=n(0),d=n.n(m),f=(n(71),n(155),n(156),n(157),n(158),n(129)),h=n(121),p=n(24),g=n(3),b=n(31),v=n(51),w=n(122),_=n.n(w),E=n(123),k=n(49),j=(window.location.hostname,{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",archivalNodeUrl:"https://rpc.testnet.internal.near.org",contractName:"dev-1613368835598-7014445",walletUrl:"https://wallet.testnet.near.org"}),N=function(t){Object(l.a)(c,t);var n=Object(u.a)(c);function c(t){var a;return Object(o.a)(this,c),(a=n.call(this,t))._near={blockViewCall:function(t,n,a){var c=this;return Object(s.a)(r.a.mark((function s(){var o,i;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=a||{},c.account.validateArgs(a),o=t+172800<c.lastBlockHeight?c.archivalConnection:c.account.connection,r.next=5,o.provider.query({request_type:"call_function",block_id:t,account_id:j.contractName,method_name:n,args_base64:new e(JSON.stringify(a),"utf8").toString("base64")});case 5:return i=r.sent,r.abrupt("return",i.result&&i.result.length>0&&JSON.parse(e.from(i.result).toString()));case 7:case"end":return r.stop()}}),s)})))()}},a.state={connected:!1,isNavCollapsed:!0,newPosts:[]},a._initNear().then((function(){a.setState({signedIn:!!a._near.accountId,signedAccountId:a._near.accountId,connected:!0})})),a}return Object(i.a)(c,[{key:"_initNear",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,a,c=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.keyStores.BrowserLocalStorageKeyStore,e.next=3,b.connect(Object.assign({deps:{keyStore:t}},j));case 3:return n=e.sent,this._near.archivalConnection=b.Connection.fromConfig({networkId:j.networkId,provider:{type:"JsonRpcProvider",args:{url:j.archivalNodeUrl}},signer:{type:"InMemorySigner",keyStore:t}}),this._near.keyStore=t,this._near.near=n,this._near.walletConnection=new b.WalletConnection(n,j.contractName),this._near.accountId=this._near.walletConnection.getAccountId(),this._near.account=this._near.walletConnection.account(),e.next=12,this._near.account.connection.provider.block({finality:"final"});case 12:return a=e.sent,this._near.lastBlockHeight=a.header.height,this._near.contract=new b.Contract(this._near.account,j.contractName,{viewMethods:["get_account","get_accounts","get_num_accounts","get_followers","get_following","get_post","storage_minimum_balance","storage_balance_of"],changeMethods:["storage_deposit","storage_withdraw","post","follow","unfollow"]}),e.next=17,this._near.contract.storage_minimum_balance();case 17:if(this._near.storageMinimumBalance=e.sent,this._near.accounts={},this._near.getAccount=function(e){return e in c._near.accounts?c._near.accounts[e]:c._near.accounts[e]=Promise.resolve(v.a.load(c._near,e))},this._near.posts={},this._near.getPost=function(e,t){var n="".concat(e,"/").concat(t);return n in c._near.posts?c._near.posts[n]:c._near.posts[n]=Promise.resolve(k.a.load(c._near,e,t))},!this._near.accountId){e.next=29;break}return e.next=25,this._near.getAccount(this._near.accountId);case 25:return this._near.accountData=e.sent,e.next=28,this._near.accountData.fetchFollowings();case 28:this.setState({followings:Object.assign({},this._near.accountData.followings),enoughStorageBalance:this._near.accountData.stats.enoughStorageBalance});case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),"NEAR Vodka",e.next=4,this._near.walletConnection.requestSignIn(j.contractName,"NEAR Vodka");case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._near.walletConnection.signOut(),this._near.accountId=null,this.setState({signedIn:!!this._accountId,signedAccountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestStorageBalance",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this._near.contract.storage_deposit({},"30000000000000","100000000000000000000000");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=Object(a.a)({_near:this._near,updateState:function(t){return e.setState(t)}},this.state),n=this.state.connected?this.state.signedIn?d.a.createElement("div",null,!this.state.enoughStorageBalance&&d.a.createElement("button",{className:"btn btn-primary me-md-2",onClick:function(t){return e.requestStorageBalance(t)}},"Add storage balance"),d.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"Log out (",this.state.signedAccountId,")")):d.a.createElement("div",null,d.a.createElement("button",{className:"btn btn-primary",onClick:function(t){return e.requestSignIn(t)}},"Log in with NEAR Wallet")):d.a.createElement("div",null,"Connecting... ",d.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return d.a.createElement("div",{className:"App"},d.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light mb-3"},d.a.createElement("div",{className:"container-fluid"},d.a.createElement("a",{className:"navbar-brand",href:"/",title:"NEAR Vodka - connecting people"},d.a.createElement("img",{src:_.a,alt:"NEAR Vodka",className:"d-inline-block align-middle"}),"[TESTNET] NEAR Vodka"),d.a.createElement("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},d.a.createElement("span",{className:"navbar-toggler-icon"})),d.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},d.a.createElement("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0"},d.a.createElement("li",{className:"nav-item"})),d.a.createElement("form",{className:"d-flex"},n)))),d.a.createElement("a",{className:"github-fork-ribbon right-bottom fixed",href:"https://github.com/evgenykuzyakov/near-vodka","data-ribbon":"Fork me on GitHub",title:"Fork me on GitHub"},"Fork me on GitHub"),d.a.createElement(p.a,{basename:""},d.a.createElement(g.c,null,d.a.createElement(g.a,{exact:!0,path:"/"},d.a.createElement(f.a,t)),d.a.createElement(g.a,{exact:!0,path:"/a/:accountId"},d.a.createElement(h.a,t)),d.a.createElement(g.a,{exact:!0,path:"/p/:accountId/:blockHeight"},d.a.createElement(E.a,t)))))}}]),c}(d.a.Component);t.a=N}).call(this,n(13).Buffer)},121:function(e,t,n){"use strict";var a=n(6),c=n(0),r=n.n(c),s=n(3),o=n(38),i=n(50);t.a=function(e){var t=Object(s.f)().accountId,n=Object(c.useState)(!1),l=Object(a.a)(n,2),u=l[0],m=l[1],d=Object(c.useState)(null),f=Object(a.a)(d,2),h=f[0],p=f[1];return e.connected&&e._near&&e._near.getAccount(t).then((function(e){p(e)})),Object(c.useEffect)((function(){e.connected&&e._near&&h&&m([[h.stats.lastPostHeight,t]])}),[e.connected,h]),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-md-center"},r.a.createElement("div",{className:"col col-lg-8 col-xl-6"},r.a.createElement("h3",null,"Account @",t),r.a.createElement(i.a,Object.assign({},e,{accountId:t,account:h})),r.a.createElement("h3",null,"Posts"),u?r.a.createElement(o.a,Object.assign({},e,{seed:u})):r.a.createElement("div",{className:"d-flex justify-content-center"},r.a.createElement("div",{className:"spinner-grow",role:"status"},r.a.createElement("span",{className:"visually-hidden"},"Loading..."))))))}},122:function(e,t,n){e.exports=n.p+"static/media/near_vodka_logo.f18e89c9.png"},123:function(e,t,n){"use strict";var a=n(6),c=n(0),r=n.n(c),s=n(3),o=n(52);t.a=function(e){var t=Object(s.f)(),n=t.accountId,i=t.blockHeight,l=Object(c.useState)(!1),u=Object(a.a)(l,2),m=u[0],d=u[1];return e.connected&&e._near&&e._near.getPost(n,parseInt(i)).then((function(e){d(e)})),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-md-center"},r.a.createElement("div",{className:"col col-lg-8 col-xl-6"},m?r.a.createElement(o.a,Object.assign({},e,{post:m})):r.a.createElement("div",{className:"d-flex justify-content-center"},r.a.createElement("div",{className:"spinner-grow",role:"status"},r.a.createElement("span",{className:"visually-hidden"},"Loading..."))))))}},129:function(e,t,n){"use strict";var a=n(1),c=n.n(a),r=n(4),s=n(6),o=(n(159),n(0)),i=n.n(o),l=n(39),u=n(49);var m=function(e){var t=Object(o.useState)(""),n=Object(s.a)(t,2),a=n[0],m=n[1],d=Object(o.useState)(!1),f=Object(s.a)(d,2),h=f[0],p=f[1],g=function(){var t=Object(r.a)(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a,p(!0),m(""),t.t0=u.b,t.next=6,e._near.contract.post({body:n});case 6:t.t1=t.sent,(r=(0,t.t0)(t.t1)).accountId=e.signedAccountId,e.updateState({newPosts:[].concat(Object(l.a)(e.newPosts),[r])}),p(!1);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return i.a.createElement("div",null,i.a.createElement("form",null,i.a.createElement("div",{className:"mb-3"},i.a.createElement("textarea",{className:"form-control",placeholder:"New post",rows:"5",value:a,onChange:function(e){return m(e.target.value)}})),i.a.createElement("div",{className:"mb-3 d-grid gap-2 d-md-flex justify-content-md-end"},i.a.createElement("button",{className:"btn btn-primary",disabled:!a,onClick:g},h?i.a.createElement("span",null,i.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}),i.a.createElement("span",{className:"visually-hidden"},"Loading...")," ","Posting"):i.a.createElement("span",null,"Post now")))))},d=n(38),f=n(51);t.a=function(e){var t=Object(o.useState)(!1),n=Object(s.a)(t,2),a=n[0],l=n[1],u=Object(o.useState)(!1),h=Object(s.a)(u,2),p=h[0],g=h[1],b=e._near.accountData;if(b&&!1===a){var v=Object.entries(b.followings).map((function(e){var t=Object(s.a)(e,2),n=t[0];return[t[1].lastPostHeight,n]}));b.stats.lastPostHeight>0&&v.push([b.stats.lastPostHeight,b.accountId]),l(v)}function w(){return(w=Object(r.a)(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._near.contract.get_num_accounts();case 2:return n=t.sent,t.next=5,e._near.contract.get_accounts({from_index:Math.max(n-100,0),limit:100});case 5:return t.abrupt("return",t.sent.map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return[Object(f.b)(a).lastPostHeight,n]})));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(o.useEffect)((function(){e.connected&&e._near&&function(){return w.apply(this,arguments)}().then((function(e){g(e)}))}),[e.connected]),i.a.createElement("div",null,i.a.createElement("div",{className:"container"},i.a.createElement("div",{className:"row justify-content-md-center"},i.a.createElement("div",{className:"col col-lg-8 col-xl-6"},e.enoughStorageBalance&&i.a.createElement(m,e),a&&a.length>0&&i.a.createElement("div",null,i.a.createElement("h3",null,"Your Feed"),i.a.createElement(d.a,Object.assign({},e,{seed:a,extraPosts:e.newPosts}))),p&&p.length>0&&i.a.createElement("div",null,i.a.createElement("h3",null,"Random people"),i.a.createElement(d.a,Object.assign({},e,{seed:p}))),(!a||!p)&&i.a.createElement("div",{className:"d-flex justify-content-center"},i.a.createElement("div",{className:"spinner-grow",role:"status"},i.a.createElement("span",{className:"visually-hidden"},"Loading...")))))))}},130:function(e,t,n){e.exports=n(131)},131:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(117),s=n.n(r),o=(n(136),n(118));s.a.render(c.a.createElement(o.a,null),document.getElementById("root"))},136:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){},159:function(e,t,n){},160:function(e,t,n){},161:function(e,t,n){},164:function(e,t,n){},174:function(e,t){},179:function(e,t){},199:function(e,t){},201:function(e,t){},38:function(e,t,n){"use strict";var a=n(1),c=n.n(a),r=n(39),s=n(4),o=n(6),i=n(0),l=n.n(i),u=n(52),m=n(120);t.a=function(e){var t=Object(i.useState)([]),n=Object(o.a)(t,2),a=n[0],d=n[1],f=e.seed,h=e.extraPosts||[];function p(){return(p=Object(s.a)(c.a.mark((function t(n){var a,r,s,i,l,u,f;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],r=Object(m.SortedSet)(n);case 2:if(!(r.length>0&&a.length<10)){t.next=12;break}if(s=r.pop(),i=Object(o.a)(s,2),l=i[0],u=i[1],0!==l){t.next=6;break}return t.abrupt("break",12);case 6:return t.next=8,e._near.getPost(u,l);case 8:(f=t.sent)&&(f.lastPostHeight>0&&r.push([f.lastPostHeight,u]),console.log(f),a.push(f),d([].concat(a))),t.next=2;break;case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(i.useEffect)((function(){!1!==f&&function(e){p.apply(this,arguments)}(f)}),[f]);var g=[].concat(Object(r.a)(h),Object(r.a)(a)).map((function(t){var n="".concat(t.accountId,"/").concat(t.blockHeight);return l.a.createElement(u.a,Object.assign({key:n,post:t},e))}));return l.a.createElement("div",null,!1!==f?g:l.a.createElement("div",{className:"d-flex justify-content-center"},l.a.createElement("div",{className:"spinner-grow",role:"status"},l.a.createElement("span",{className:"visually-hidden"},"Loading..."))))}},49:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return i}));var a=n(1),c=n.n(a),r=n(4),s=n(29),o=n(30),i=function(e){return{body:e.body,time:new Date(parseFloat(e.time)/1e6),blockHeight:e.block_height,lastPostHeight:e.last_post_height}},l=function(){function e(t,n,a){Object(s.a)(this,e),this._near=t,this.accountId=n,this.requestBlockHeight=a,this._ready=!1}return Object(o.a)(e,[{key:"fetch",value:function(){var e=Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._near.blockViewCall(this.requestBlockHeight,"get_post",{account_id:this.accountId});case 2:(t=e.sent)&&Object.assign(this,i(t)),this._ready=!0;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"load",value:function(){var t=Object(r.a)(c.a.mark((function t(n,a,r){var s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=new e(n,a,r),t.next=3,s.fetch();case 3:return t.abrupt("return",s);case 4:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()}]),e}()},50:function(e,t,n){"use strict";var a=n(1),c=n.n(a),r=n(4),s=n(0),o=n.n(s);n(164);t.a=function(e){var t=e.accountId,n=e.account,a=function(){var a=Object(r.a)(c.a.mark((function a(){return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.followings&&!(t in e.followings)){a.next=2;break}return a.abrupt("return");case 2:return e._near.accountData.followings[t]=n.stats,e.updateState({followings:Object.assign({},e._near.accountData.followings)}),a.next=6,e._near.contract.follow({account_id:t});case 6:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),s=function(){var n=Object(r.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.followings&&t in e.followings){n.next=2;break}return n.abrupt("return");case 2:return delete e._near.accountData.followings[t],e.updateState({followings:Object.assign({},e._near.accountData.followings)}),n.next=6,e._near.contract.unfollow({account_id:t});case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return o.a.createElement("div",{className:"follow-button mb-3"},n?t===e.signedAccountId?o.a.createElement("div",null,"It's you"):e.followings&&t in e.followings?o.a.createElement("button",{className:"btn btn-primary btn-unfollow",onClick:s},o.a.createElement("span",null,"Following")):o.a.createElement("button",{className:"btn btn-outline-primary btn-follow",onClick:a},"Follow"):o.a.createElement("div",{className:"spinner-grow",role:"status"},o.a.createElement("span",{className:"visually-hidden"},"Loading...")))}},51:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return d}));var a=n(6),c=n(1),r=n.n(c),s=n(4),o=n(29),i=n(30),l=n(17),u=n.n(l),m=new u.a("50000000000000000000000"),d=function(e){return{numPosts:e.num_posts,numFollowers:e.num_followers,numFollowing:e.num_following,lastPostHeight:e.last_post_height}},f=function(){function e(t,n){Object(o.a)(this,e),this._near=t,this.accountId=n,this.stats={lastPostHeight:0,numFollowers:0,numFollowing:0,numPosts:0,enoughStorageBalance:!1},this.followings=!1,this.followers=!1,this._ready=!1}return Object(i.a)(e,[{key:"_fetchStorageBalance",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._near.contract.storage_balance_of({account_id:this.accountId});case 2:t=e.sent,this.stats.storageTotal=new u.a(t.total),this.stats.storageAvailable=new u.a(t.available),this.stats.enoughStorageBalance=this.stats.storageAvailable>m;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_fetchAccountStats",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._near.contract.get_account({account_id:this.accountId});case 2:(t=e.sent)&&Object.assign(this.stats,d(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetch",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._fetchStorageBalance(),this._fetchAccountStats()]);case 2:this._ready=!0;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchFollowings",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,c=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1===this.followings){e.next=2;break}return e.abrupt("return");case 2:for(t=[],n=0;n<this.stats.numFollowing;n+=100)t.push(this._near.contract.get_following({account_id:this.accountId,from_index:n,limit:100}));return this.followings={},e.next=7,Promise.all(t);case 7:e.sent.flat().forEach((function(e){var t=Object(a.a)(e,2),n=t[0],r=t[1];c.followings[n]=d(r)}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"load",value:function(){var t=Object(s.a)(r.a.mark((function t(n,a){var c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=new e(n,a),t.next=3,c.fetch();case 3:return t.abrupt("return",c);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}()},52:function(e,t,n){"use strict";var a=n(0),c=n.n(a),r=(n(160),n(6)),s=(n(161),n(126)),o=n(24),i=n(50);var l=function(e){var t=Object(a.useState)(null),n=Object(r.a)(t,2),l=n[0],u=n[1],m=e.accountId;return e.connected&&e._near&&e._near.getAccount(m).then((function(e){u(e)})),c.a.createElement("div",{className:"account"},c.a.createElement(o.b,{className:"account-handle","data-tip":!0,"data-for":"rt-".concat(m),to:"/a/".concat(m)},"@",m),c.a.createElement(s.a,{id:"rt-".concat(m),className:"account-tooltip",delayHide:100,delayShow:200,effect:"solid"},c.a.createElement("div",null,c.a.createElement("h5",null,c.a.createElement(o.b,{className:"account-handle",to:"/a/".concat(m)},"@",m))),c.a.createElement(i.a,Object.assign({},e,{accountId:m,account:l})),l&&c.a.createElement("div",null,c.a.createElement("div",null,"Num posts: ",l.stats.numPosts),c.a.createElement("div",null,"Num followers: ",l.stats.numFollowers),c.a.createElement("div",null,"Num following: ",l.stats.numFollowing))))},u=n(124);t.a=function(e){var t=e.post;return c.a.createElement("div",{className:"card mb-3"},c.a.createElement("div",{className:"card-body"},c.a.createElement("h5",{className:"card-title"},c.a.createElement(l,Object.assign({},e,{accountId:t.accountId}))),c.a.createElement("h6",{className:"card-subtitle mb-2 text-muted"},c.a.createElement(o.b,{className:"post-link",to:"/p/".concat(t.accountId,"/").concat(t.blockHeight)},c.a.createElement(u.a,{datetime:t.time}))),c.a.createElement("div",{className:"card-text"},t.body)))}}},[[130,1,2]]]);
//# sourceMappingURL=main.96874e74.chunk.js.map