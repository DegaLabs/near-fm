(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{116:function(t,e,n){"use strict";(function(t){var a=n(1),c=n.n(a),r=n(5),o=n(46),s=n(47),i=n(124),u=n(122),l=n(0),f=n.n(l),m=(n(69),n(151),n(152),n(153),n(154),n(125)),d=n(119),h=n(35),p=n(3),g=n(28),b=n(50),v=n(120),w=n.n(v),_=(window.location.hostname,{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",archivalNodeUrl:"https://rpc.testnet.internal.near.org",contractName:"dev-1613368835598-7014445",walletUrl:"https://wallet.testnet.near.org"}),E=function(e){Object(i.a)(a,e);var n=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=n.call(this,e))._near={blockViewCall:function(e,n,a){var o=this;return Object(r.a)(c.a.mark((function r(){var s,i;return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return a=a||{},o.account.validateArgs(a),s=e+172800<o.lastBlockHeight?o.archivalConnection:o.account.connection,c.next=5,s.provider.query({request_type:"call_function",block_id:e,account_id:_.contractName,method_name:n,args_base64:new t(JSON.stringify(a),"utf8").toString("base64")});case 5:return i=c.sent,c.abrupt("return",i.result&&i.result.length>0&&JSON.parse(t.from(i.result).toString()));case 7:case"end":return c.stop()}}),r)})))()}},s.state={connected:!1,isNavCollapsed:!0,newPosts:[]},s._initNear().then((function(){s.setState({signedIn:!!s._near.accountId,signedAccountId:s._near.accountId,connected:!0})})),s}return Object(s.a)(a,[{key:"_initNear",value:function(){var t=Object(r.a)(c.a.mark((function t(){var e,n,a,r=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new g.keyStores.BrowserLocalStorageKeyStore,t.next=3,g.connect(Object.assign({deps:{keyStore:e}},_));case 3:return n=t.sent,this._near.archivalConnection=g.Connection.fromConfig({networkId:_.networkId,provider:{type:"JsonRpcProvider",args:{url:_.archivalNodeUrl}},signer:{type:"InMemorySigner",keyStore:e}}),this._near.keyStore=e,this._near.near=n,this._near.walletConnection=new g.WalletConnection(n,_.contractName),this._near.accountId=this._near.walletConnection.getAccountId(),this._near.account=this._near.walletConnection.account(),t.next=12,this._near.account.connection.provider.block({finality:"final"});case 12:return a=t.sent,this._near.lastBlockHeight=a.header.height,this._near.contract=new g.Contract(this._near.account,_.contractName,{viewMethods:["get_account","get_accounts","get_num_accounts","get_followers","get_following","get_post","storage_minimum_balance","storage_balance_of"],changeMethods:["storage_deposit","storage_withdraw","post","follow","unfollow"]}),t.next=17,this._near.contract.storage_minimum_balance();case 17:if(this._near.storageMinimumBalance=t.sent,this._near.accounts={},this._near.getAccount=function(t){return t in r._near.accounts?r._near.accounts[t]:r._near.accounts[t]=Promise.resolve(b.a.load(r._near,t))},!this._near.accountId){t.next=27;break}return t.next=23,this._near.getAccount(this._near.accountId);case 23:return this._near.accountData=t.sent,t.next=26,this._near.accountData.fetchFollowings();case 26:this.setState({followings:Object.assign({},this._near.accountData.followings),enoughStorageBalance:this._near.accountData.stats.enoughStorageBalance});case 27:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var t=Object(r.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),"NEAR Vodka",t.next=4,this._near.walletConnection.requestSignIn(_.contractName,"NEAR Vodka");case 4:return t.abrupt("return",!1);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"logOut",value:function(){var t=Object(r.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._near.walletConnection.signOut(),this._near.accountId=null,this.setState({signedIn:!!this._accountId,signedAccountId:this._accountId});case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"requestStorageBalance",value:function(){var t=Object(r.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.next=3,this._near.contract.storage_deposit({},"30000000000000","100000000000000000000000");case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;window.yo=this;var e=this.state.connected?this.state.signedIn?f.a.createElement("div",null,!this.state.enoughStorageBalance&&f.a.createElement("button",{className:"btn btn-primary me-md-2",onClick:function(e){return t.requestStorageBalance(e)}},"Add storage balance"),f.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return t.logOut()}},"Log out (",this.state.signedAccountId,")")):f.a.createElement("div",null,f.a.createElement("button",{className:"btn btn-primary",onClick:function(e){return t.requestSignIn(e)}},"Log in with NEAR Wallet")):f.a.createElement("div",null,"Connecting... ",f.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return f.a.createElement("div",{className:"App"},f.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light mb-3"},f.a.createElement("div",{className:"container-fluid"},f.a.createElement("a",{className:"navbar-brand",href:"/",title:"NEAR Vodka - connecting people"},f.a.createElement("img",{src:w.a,alt:"NEAR Vodka",className:"d-inline-block align-middle"}),"[TESTNET] NEAR Vodka"),f.a.createElement("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},f.a.createElement("span",{className:"navbar-toggler-icon"})),f.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},f.a.createElement("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0"},f.a.createElement("li",{className:"nav-item"})),f.a.createElement("form",{className:"d-flex"},e)))),f.a.createElement("a",{className:"github-fork-ribbon right-bottom fixed",href:"https://github.com/evgenykuzyakov/near-vodka","data-ribbon":"Fork me on GitHub",title:"Fork me on GitHub"},"Fork me on GitHub"),f.a.createElement(h.a,{basename:""},f.a.createElement(p.c,null,f.a.createElement(p.a,{exact:!0,path:"/"},f.a.createElement(m.a,Object.assign({_near:this._near},this.state,{updateState:function(e){return t.setState(e)}}))),f.a.createElement(p.a,{exact:!0,path:"/a/:accountId"},f.a.createElement(d.a,Object.assign({_near:this._near},this.state,{updateState:function(e){return t.setState(e)}}))))))}}]),a}(f.a.Component);e.a=E}).call(this,n(13).Buffer)},119:function(t,e,n){"use strict";var a=n(8),c=n(0),r=n.n(c),o=n(3),s=n(37),i=n(49);e.a=function(t){var e=Object(o.f)().accountId,n=Object(c.useState)(!1),u=Object(a.a)(n,2),l=u[0],f=u[1],m=Object(c.useState)(null),d=Object(a.a)(m,2),h=d[0],p=d[1];return t.connected&&t._near&&t._near.getAccount(e).then((function(t){p(t)})),Object(c.useEffect)((function(){t.connected&&t._near&&h&&f([[h.stats.lastPostHeight,e]])}),[t.connected,h]),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-md-center"},r.a.createElement("div",{className:"col col-lg-8 col-xl-6"},r.a.createElement("h3",null,"Account @",e),r.a.createElement(i.a,Object.assign({},t,{accountId:e,account:h})),r.a.createElement("h3",null,"Posts"),l&&r.a.createElement(s.a,Object.assign({},t,{seed:l})))))}},120:function(t,e,n){t.exports=n.p+"static/media/near_vodka_logo.f18e89c9.png"},125:function(t,e,n){"use strict";var a=n(1),c=n.n(a),r=n(5),o=n(8),s=(n(155),n(0)),i=n.n(s),u=n(36);var l=function(t){var e=Object(s.useState)(""),n=Object(o.a)(e,2),a=n[0],l=n[1],f=function(){var e=Object(r.a)(c.a.mark((function e(){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a,l(""),e.next=4,t._near.contract.post({body:n});case 4:r={accountId:t.signedAccountId,post:{body:n,time:(1e6*(new Date).getTime()).toString()}},t.updateState({newPosts:[].concat(Object(u.a)(t.newPosts),[r])});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.createElement("div",null,i.a.createElement("form",null,i.a.createElement("div",{className:"mb-3"},i.a.createElement("textarea",{className:"form-control",placeholder:"New post",rows:"5",value:a,onChange:function(t){return l(t.target.value)}})),i.a.createElement("div",{className:"mb-3 d-grid gap-2 d-md-flex justify-content-md-end"},i.a.createElement("button",{className:"btn btn-primary",disabled:!a,onClick:f},"Post now"))))},f=n(37),m=n(50);e.a=function(t){var e=Object(s.useState)(!1),n=Object(o.a)(e,2),a=n[0],u=n[1],d=Object(s.useState)(!1),h=Object(o.a)(d,2),p=h[0],g=h[1],b=t._near.accountData;if(b&&!1===a){var v=Object.entries(b.followings).map((function(t){var e=Object(o.a)(t,2),n=e[0];return[e[1].lastPostHeight,n]}));b.stats.lastPostHeight>0&&v.push([b.stats.lastPostHeight,b.accountId]),u(v)}function w(){return(w=Object(r.a)(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._near.contract.get_num_accounts();case 2:return n=e.sent,e.next=5,t._near.contract.get_accounts({from_index:Math.max(n-100,0),limit:100});case 5:return e.abrupt("return",e.sent.map((function(t){var e=Object(o.a)(t,2),n=e[0],a=e[1];return[Object(m.b)(a).lastPostHeight,n]})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(s.useEffect)((function(){t.connected&&t._near&&function(){return w.apply(this,arguments)}().then((function(t){g(t)}))}),[t.connected]),i.a.createElement("div",null,i.a.createElement("div",{className:"container"},i.a.createElement("div",{className:"row justify-content-md-center"},i.a.createElement("div",{className:"col col-lg-8 col-xl-6"},t.enoughStorageBalance&&i.a.createElement(l,t),a&&a.length>0&&i.a.createElement("div",null,i.a.createElement("h3",null,"Feed"),i.a.createElement(f.a,Object.assign({},t,{seed:a,extraPosts:t.newPosts}))),p&&i.a.createElement("div",null,i.a.createElement("h3",null,"Random"),i.a.createElement(f.a,Object.assign({},t,{seed:p})))))))}},126:function(t,e,n){t.exports=n(127)},127:function(t,e,n){"use strict";n.r(e);var a=n(0),c=n.n(a),r=n(115),o=n.n(r),s=(n(132),n(116));o.a.render(c.a.createElement(s.a,null),document.getElementById("root"))},132:function(t,e,n){},153:function(t,e,n){},154:function(t,e,n){},155:function(t,e,n){},156:function(t,e,n){},157:function(t,e,n){},160:function(t,e,n){},170:function(t,e){},175:function(t,e){},195:function(t,e){},197:function(t,e){},37:function(t,e,n){"use strict";var a=n(1),c=n.n(a),r=n(36),o=n(5),s=n(8),i=n(0),u=n.n(i),l=(n(156),n(157),n(123)),f=n(35),m=n(49);var d=function(t){var e=Object(i.useState)(null),n=Object(s.a)(e,2),a=n[0],c=n[1],r=t.accountId;return t.connected&&t._near&&t._near.getAccount(r).then((function(t){c(t)})),u.a.createElement("div",{className:"account"},u.a.createElement(f.b,{className:"account-handle","data-tip":!0,"data-for":"rt-".concat(r),to:"/a/".concat(r)},"@",r),u.a.createElement(l.a,{id:"rt-".concat(r),className:"account-tooltip",delayHide:100,delayShow:200,effect:"solid"},u.a.createElement("div",null,u.a.createElement("h5",null,u.a.createElement(f.b,{className:"account-handle",to:"/a/".concat(r)},"@",r))),u.a.createElement(m.a,Object.assign({},t,{accountId:r,account:a})),a&&u.a.createElement("div",null,u.a.createElement("div",null,"Num posts: ",a.stats.numPosts),u.a.createElement("div",null,"Num followers: ",a.stats.numFollowers),u.a.createElement("div",null,"Num following: ",a.stats.numFollowing))))},h=n(121);var p=function(t){var e=t.accountId,n=t.post;return u.a.createElement("div",{className:"card mb-3"},u.a.createElement("div",{className:"card-body"},u.a.createElement("h5",{className:"card-title"},u.a.createElement(d,Object.assign({},t,{accountId:e}))),u.a.createElement("h6",{className:"card-subtitle mb-2 text-muted"},u.a.createElement(h.a,{datetime:new Date(parseFloat(n.time)/1e6)})),u.a.createElement("div",{className:"card-text"},n.body)))},g=n(118);e.a=function(t){var e=Object(i.useState)([]),n=Object(s.a)(e,2),a=n[0],l=n[1],f=t.seed,m=t.extraPosts||[];function d(){return(d=Object(o.a)(c.a.mark((function e(n){var a,r,o,i,u,f,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],r=Object(g.SortedSet)(n);case 2:if(!(r.length>0&&a.length<10)){e.next=12;break}if(o=r.pop(),i=Object(s.a)(o,2),u=i[0],f=i[1],0!==u){e.next=6;break}return e.abrupt("break",12);case 6:return e.next=8,t._near.blockViewCall(u,"get_post",{account_id:f});case 8:(m=e.sent)&&(m.last_post_height>0&&r.push([m.last_post_height,f]),a.push({accountId:f,post:m}),l([].concat(a))),e.next=2;break;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(i.useEffect)((function(){!1!==f&&function(t){d.apply(this,arguments)}(f)}),[f]);var h=[].concat(Object(r.a)(m),Object(r.a)(a)).map((function(e){var n="".concat(e.accountId,"/").concat(e.post.block_height);return u.a.createElement(p,Object.assign({key:n,accountId:e.accountId,post:e.post},t))}));return u.a.createElement("div",null,h)}},49:function(t,e,n){"use strict";var a=n(1),c=n.n(a),r=n(5),o=n(0),s=n.n(o);n(160);e.a=function(t){var e=t.accountId,n=t.account,a=function(){var a=Object(r.a)(c.a.mark((function a(){return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.followings&&!(e in t.followings)){a.next=2;break}return a.abrupt("return");case 2:return t._near.accountData.followings[e]=n.stats,t.updateState({followings:Object.assign({},t._near.accountData.followings)}),a.next=6,t._near.contract.follow({account_id:e});case 6:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),o=function(){var n=Object(r.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.followings&&e in t.followings){n.next=2;break}return n.abrupt("return");case 2:return delete t._near.accountData.followings[e],t.updateState({followings:Object.assign({},t._near.accountData.followings)}),n.next=6,t._near.contract.unfollow({account_id:e});case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return s.a.createElement("div",{className:"follow-button mb-3"},n?e===t.signedAccountId?s.a.createElement("div",null,"It's you"):t.followings&&e in t.followings?s.a.createElement("button",{className:"btn btn-primary btn-unfollow",onClick:o},s.a.createElement("span",null,"Following")):s.a.createElement("button",{className:"btn btn-outline-primary btn-follow",onClick:a},"Follow"):s.a.createElement("div",null,"Loading"))}},50:function(t,e,n){"use strict";n.d(e,"a",(function(){return d})),n.d(e,"b",(function(){return m}));var a=n(8),c=n(1),r=n.n(c),o=n(5),s=n(46),i=n(47),u=n(17),l=n.n(u),f=new l.a("50000000000000000000000"),m=function(t){return{numPosts:t.num_posts,numFollowers:t.num_followers,numFollowing:t.num_following,lastPostHeight:t.last_post_height}},d=function(){function t(e,n){Object(s.a)(this,t),this._near=e,this.accountId=n,this.stats={lastPostHeight:0,numFollowers:0,numFollowing:0,numPosts:0,enoughStorageBalance:!1},this.followings=!1,this.followers=!1,this._ready=!1}return Object(i.a)(t,[{key:"_fetchStorageBalance",value:function(){var t=Object(o.a)(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._near.contract.storage_balance_of({account_id:this.accountId});case 2:e=t.sent,this.stats.storageTotal=new l.a(e.total),this.stats.storageAvailable=new l.a(e.available),this.stats.enoughStorageBalance=this.stats.storageAvailable>f;case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"_fetchAccountStats",value:function(){var t=Object(o.a)(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._near.contract.get_account({account_id:this.accountId});case 2:(e=t.sent)&&Object.assign(this.stats,m(e));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"fetch",value:function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this._fetchStorageBalance(),this._fetchAccountStats()]);case 2:this._ready=!0;case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"fetchFollowings",value:function(){var t=Object(o.a)(r.a.mark((function t(){var e,n,c=this;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1===this.followings){t.next=2;break}return t.abrupt("return");case 2:for(e=[],n=0;n<this.stats.numFollowing;n+=100)e.push(this._near.contract.get_following({account_id:this.accountId,from_index:n,limit:100}));return this.followings={},t.next=7,Promise.all(e);case 7:t.sent.flat().forEach((function(t){var e=Object(a.a)(t,2),n=e[0],r=e[1];c.followings[n]=m(r)}));case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}],[{key:"load",value:function(){var e=Object(o.a)(r.a.mark((function e(n,a){var c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new t(n,a),e.next=3,c.fetch();case 3:return e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),t}()}},[[126,1,2]]]);
//# sourceMappingURL=main.01360d67.chunk.js.map